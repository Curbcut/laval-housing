---
title: "6.1 À but lucratif (abordable, prix du marché)"
author: "Curbcut"
output: html_document
---

```{r setup_6_1, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
qs::qload(here::here("data", "section_6_1.qsm"))
library(tidyverse)
library(gt)
library(patchwork)

```

# 6.1.1 Dév rés récent (répartition territoriale par type de logement et typologie)

```{r s_6_1_1, include = FALSE}

# Min and max 5-year avg
min_max_vals <- 
  completions_by_type |> 
  filter(is.na(zone)) |>
  filter(type == "All") |> 
  mutate(value_trend = slider::slide_dbl(value, mean, .before = 2, .after = 2), 
         .by = type) |>
  filter(value_trend %in% c(min(value_trend), max(value_trend)))

# Completion % in Chomedey/Sainte-Dorothée
comp_pct <- 
  completions_by_type |> 
  filter(!is.na(zone), type == "All", year >= 2014, year <= 2018) |> 
  summarize(val = sum(value[zone == "Chomedey/Sainte-Dorothée"]) / sum(value)) |> 
  pull(val) |> 
  scales::percent(0.1)

# Completion % for rental
rent_pct <- 
  completions_by_market |> 
  filter(is.na(zone), market != "All", year >= 2015) |> 
  summarize(val = sum(value[market == "Rental"]) / sum(value)) |> 
  pull(val) |> 
  scales::percent(0.1)

```

Since 1990, the number of annual housing completions in Laval has remained relatively level, albeit with high levels of year-to-year fluctuation. The five-year period with the most completions has been `r paste0(min_max_vals$year[2] - 2, "-", min_max_vals$year[2] + 2)`, when there was an average of `r min_max_vals$value_trend[2]` housing units completed each year. By contrast, in the period `r paste0(min_max_vals$year[1] - 2, "-", min_max_vals$year[1] + 2)` only `r min_max_vals$value_trend[1]` housing units were completed on average each year.

```{r plot_6_1_1_overall}
plot_6_1_1_overall
```

```{r table_6_1_1_five_year}
table_6_1_1_five_year
```

Prior to 2000, most newly constructed housing in Laval comprised single-family homes, with some semi-detached homes also being constructed particularly in the early 1990s. However, since 2000, there has been a substantial shift away from single-detached homes and towards apartments. Annual single-family housing completions peaked in 2003 and have been declining every year since (albeit with minor fluctuations). By contrast, since 2000 apartment completions have surged, with a five-year moving average demonstrating ongoing increases in the total number of apartments entering the market each year.

There have been no meaningful semi-detached housing completions since the early 1990s, and row houses have consistently been a negligible portion of total completions.

```{r plot_6_1_1_type}
plot_6_1_1_type
```

```{r plot_6_1_1_type_facet}
plot_6_1_1_type_facet
```

The same basic trends are evident looking at housing completions by intended market instead of dwelling type. Homeowner housing completions have steadily declined since a recent peak in the early 2000s. Rental and condominium completions are much more volatile—reflecting a smaller number of large projects. Both increased from near-zero levels in the 1990s. In the case of condominiums, completions began rising in the late 2000s, peaked in 2010, and have since been declining. Rental completions, by contrast, began increasing in the late 2000s and have been increasing ever since. `r rent_pct` of all Laval housing completions since 2015 have been intended for the rental market. There have been no co-operative housing completions in Laval in the period of time that CMHC has tracked this information.

```{r plot_6_1_1_market}
plot_6_1_1_market
```

```{r plot_6_1_1_market_facet}
plot_6_1_1_market_facet
```


Both in absolute and per-dwelling terms, housing development has been concentrated in the southern Chomedey/Sainte-Dorothée region of Laval. This pattern has remained relatively consistent 2009, although was particularly extreme in the 2014-2018 period, where `r comp_pct` of all new housing completions were in the Chomedey/Sainte-Dorothée zone.

```{r map_6_1_1_annual}
map_6_1_1_annual
```


# 6.1.2 Mises en chantier par typologie

```{r s_6_1_2, include = FALSE}

# Min and max 5-year avg
start_min_max <- 
  starts_by_type |> 
  filter(is.na(zone)) |>
  filter(type == "All") |> 
  mutate(value_trend = slider::slide_dbl(value, mean, .before = 2, .after = 2), 
         .by = type) |>
  filter(value_trend %in% c(min(value_trend), max(value_trend)))

# Start % in Chomedey/Sainte-Dorothée
start_pct <- 
  starts_by_type |> 
  filter(!is.na(zone), type == "All", year >= 2014, year <= 2018) |> 
  summarize(val = sum(value[zone == "Chomedey/Sainte-Dorothée"]) / sum(value)) |> 
  pull(val) |> 
  scales::percent(0.1)

# Starts in the last three years
starts_21_23 <- 
  starts_by_type |> 
  filter(is.na(zone), type == "All", year >= 2021) |> 
  pull(value) |> 
  sum()

```

From the mid-1990s through 2010, the number of annual housing starts in Laval was increasing steadily, albeit with some year-to-year fluctuation. Since 2010, however, the trend has reversed, and a five-year moving average of starts shows a clear decline over the last 15 years. The five-year period with the most completions has been `r paste0(start_min_max$year[1] - 2, "-", start_min_max$year[1] + 2)`, when there was an average of `r start_min_max$value_trend[1]` housing units started each year. By contrast, in the period `r paste0(start_min_max$year[2] - 2, "-", start_min_max$year[2] - 2)` only `r start_min_max$value_trend[2]` housing units were started on average each year.

```{r plot_6_1_2_overall}
plot_6_1_2_overall
```

```{r table_6_1_2_five_year}
table_6_1_2_five_year
```

Prior to 2000, most newly initated housing projects in Laval comprised single-family homes, with some semi-detached homes also being constructed particularly in the early 1990s. However, since 2000, there has been a substantial shift away from single-detached homes and towards apartments. Annual single-family housing starts peaked in 2003 and have been declining every year since (albeit with minor fluctuations). By contrast, since 2000 apartment starts have surged. On the one hand, apartment projects have been steadily increasing as a proportion of total starts. In 2023, in fact, every single housing start was for an apartment project. On the other hand, the absolute number of housing starts—apartments included—has been declining. Over the last three years (2021-2023), there have only been `r starts_21_23` housing units initiated in Laval. The implication is that housing completions will soon catch up to this trend, and that very few housing units will be added to the City's total housing stock in the next few years. 

```{r plot_6_1_2_type}
plot_6_1_2_type
```

```{r plot_6_1_2_type_facet}
plot_6_1_2_type_facet
```

```{r plot_6_1_2_type_apart}
plot_6_1_2_type_apart
```

Both in absolute and per-dwelling terms, new housing starts have been concentrated in the southern Chomedey/Sainte-Dorothée region of Laval. This pattern has remained relatively consistent 2009, although was particularly extreme in the 2014-2018 period, where `r start_pct` of all new housing starts were in the Chomedey/Sainte-Dorothée zone.

```{r map_6_1_2_annual}
map_6_1_2_annual
```

# 6.1.3 Mises en chantier par mode d'occupation

```{r s_6_1_3, include = FALSE}

# Min and max 5-year avg
start_market_min_max <- 
  starts_by_market |> 
  filter(is.na(zone)) |>
  filter(market != "All", market != "Unknown", market != "Co-Op") |> 
  mutate(value_trend = slider::slide_dbl(value, mean, .before = 2, .after = 2), 
         .by = market) |> 
  filter(year >= 1992) |> 
  summarize(
    owner_max = max(value_trend[market == "Homeowner"]),
    owner_year = year[value_trend == max(value_trend[market == "Homeowner"])],
    condo_max = max(value_trend[market == "Condo"]),
    condo_year = year[value_trend == max(value_trend[market == "Condo"])],
    rental_max = max(value_trend[market == "Rental"]),
    rental_year = year[value_trend == max(value_trend[market == "Rental"])])
```
Housing starts display similar patterns when broken down by intended market. High rates of new housing projects intended for the homeowner market in the 1990s and 2000s have given way first to condominium starts and more recently to rental starts. Looking at five-year moving averages, homeowner starts peaked in `r paste0(start_market_min_max$owner_year - 2, "-", start_market_min_max$owner_year + 2)` at `r start_market_min_max$owner_max` per year. Condominium starts peaked in `r paste0(start_market_min_max$condo_year - 2, "-", start_market_min_max$condo_year + 2)` at `r start_market_min_max$condo_max` per year. And rental starts peaked in `r paste0(start_market_min_max$rental_year - 2, "-", start_market_min_max$rental_year + 2)` at `r start_market_min_max$rental_max` per year.

```{r table_6_1_3_five_year}
table_6_1_3_five_year
```

```{r plot_6_1_3_market}
plot_6_1_3_market
```

```{r plot_6_1_3_market_facet}
plot_6_1_3_market_facet
```

Mirroring the shift discussed in 6.1.2 towards apartment housing starts, sine 2010 an increasingly high percentage of annual housing starts have been intended for the rental market, albeit with a high level of volatility.

```{r plot_6_1_3_market_rental}
plot_6_1_3_market_rental
```

# 6.1.4 Mises en chantier par nombre de chambres à coucher

# 6.1.5 Prix des logements neufs

# 6.1.7 Mises en chantier selon le prix par nombre de chambres à coucher

# 6.1.12 Valeur foncière (si possible Ventilé par typologie et au pied carré)
